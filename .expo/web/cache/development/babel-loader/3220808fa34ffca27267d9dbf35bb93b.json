{"ast":null,"code":"import { defineAnimation } from \"./util\";\nexport function withDelay(delayMs, _nextAnimation) {\n  'worklet';\n\n  return defineAnimation(_nextAnimation, function () {\n    'worklet';\n\n    var nextAnimation = typeof _nextAnimation === 'function' ? _nextAnimation() : _nextAnimation;\n    function delay(animation, now) {\n      var startTime = animation.startTime,\n        started = animation.started,\n        previousAnimation = animation.previousAnimation;\n      if (now - startTime > delayMs) {\n        if (!started) {\n          nextAnimation.onStart(nextAnimation, animation.current, now, previousAnimation);\n          animation.previousAnimation = null;\n          animation.started = true;\n        }\n        var finished = nextAnimation.onFrame(nextAnimation, now);\n        animation.current = nextAnimation.current;\n        return finished;\n      } else if (previousAnimation) {\n        var _finished = previousAnimation.finished || previousAnimation.onFrame(previousAnimation, now);\n        animation.current = previousAnimation.current;\n        if (_finished) {\n          animation.previousAnimation = null;\n        }\n      }\n      return false;\n    }\n    function onStart(animation, value, now, previousAnimation) {\n      animation.startTime = now;\n      animation.started = false;\n      animation.current = value;\n      if (previousAnimation === animation) {\n        animation.previousAnimation = previousAnimation.previousAnimation;\n      } else {\n        animation.previousAnimation = previousAnimation;\n      }\n    }\n    var callback = function callback(finished) {\n      if (nextAnimation.callback) {\n        nextAnimation.callback(finished);\n      }\n    };\n    return {\n      isHigherOrder: true,\n      onFrame: delay,\n      onStart: onStart,\n      current: nextAnimation.current,\n      callback: callback,\n      previousAnimation: null,\n      startTime: 0,\n      started: false\n    };\n  });\n}","map":{"version":3,"mappings":"AAAA,SAASA,eAAT;AAIA,OAAO,SAASC,SAAT,CACLC,OADK,EAELC,cAFK,EAGsB;EAC3B;;EACA,OAAOH,eAAe,CAAiBG,cAAjB,EAAiC,YAAM;IAC3D;;IACA,IAAMC,aAAa,GACjB,OAAOD,cAAP,KAA0B,UAA1B,GAAuCA,cAAc,EAArD,GAA0DA,cAD5D;IAGA,SAASE,KAAT,CAAeC,SAAf,EAA0CC,GAA1C,EAAmE;MACjE,IAAQC,SAAF,GAA4CF,SAAlD,CAAQE,SAAF;QAAaC,OAAb,GAA4CH,SAAlD,CAAmBG,OAAb;QAAsBC,oBAAsBJ,SAAlD,CAA4BI;MAE5B,IAAIH,GAAG,GAAGC,SAAN,GAAkBN,OAAtB,EAA+B;QAC7B,IAAI,CAACO,OAAL,EAAc;UACZL,aAAa,CAACO,OAAd,CACEP,aADF,EAEEE,SAAS,CAACM,OAFZ,EAGEL,GAHF,EAIEG,iBAJF;UAMAJ,SAAS,CAACI,iBAAV,GAA8B,IAA9B;UACAJ,SAAS,CAACG,OAAV,GAAoB,IAApB;QACD;QACD,IAAMI,QAAQ,GAAGT,aAAa,CAACU,OAAd,CAAsBV,aAAtB,EAAqCG,GAArC,CAAjB;QACAD,SAAS,CAACM,OAAV,GAAoBR,aAAa,CAACQ,OAAlC;QACA,OAAOC,QAAP;MACD,CAdD,MAcO,IAAIH,iBAAJ,EAAuB;QAC5B,IAAMG,SAAQ,GACZH,iBAAiB,CAACG,QAAlB,IACAH,iBAAiB,CAACI,OAAlB,CAA0BJ,iBAA1B,EAA6CH,GAA7C,CAFF;QAGAD,SAAS,CAACM,OAAV,GAAoBF,iBAAiB,CAACE,OAAtC;QACA,IAAIC,SAAJ,EAAc;UACZP,SAAS,CAACI,iBAAV,GAA8B,IAA9B;QACD;MACF;MACD,OAAO,KAAP;IACD;IAED,SAASC,OAAT,CACEL,SADF,EAEES,KAFF,EAGER,GAHF,EAIEG,iBAJF,EAKQ;MACNJ,SAAS,CAACE,SAAV,GAAsBD,GAAtB;MACAD,SAAS,CAACG,OAAV,GAAoB,KAApB;MACAH,SAAS,CAACM,OAAV,GAAoBG,KAApB;MACA,IAAIL,iBAAiB,KAAKJ,SAA1B,EAAqC;QACnCA,SAAS,CAACI,iBAAV,GAA8BA,iBAAiB,CAACA,iBAAhD;MACD,CAFD,MAEO;QACLJ,SAAS,CAACI,iBAAV,GAA8BA,iBAA9B;MACD;IACF;IAED,IAAMM,QAAQ,GAAIH,SAAZG,QAAQ,CAAIH,QAAD,EAA8B;MAC7C,IAAIT,aAAa,CAACY,QAAlB,EAA4B;QAC1BZ,aAAa,CAACY,QAAd,CAAuBH,QAAvB;MACD;IACF,CAJD;IAMA,OAAO;MACLI,aAAa,EAAE,IADV;MAELH,OAAO,EAAET,KAFJ;MAGLM,OAHK,EAGLA,OAHK;MAILC,OAAO,EAAER,aAAa,CAACQ,OAJlB;MAKLI,QALK,EAKLA,QALK;MAMLN,iBAAiB,EAAE,IANd;MAOLF,SAAS,EAAE,CAPN;MAQLC,OAAO,EAAE;IARJ,CAAP;EAUD,CAlEqB,CAAtB;AAmED","names":["defineAnimation","withDelay","delayMs","_nextAnimation","nextAnimation","delay","animation","now","startTime","started","previousAnimation","onStart","current","finished","onFrame","value","callback","isHigherOrder"],"sources":["delay.ts"],"sourcesContent":["import { defineAnimation } from './util';\nimport { Animation, Timestamp, AnimatableValue } from '../commonTypes';\nimport { NextAnimation, DelayAnimation } from './commonTypes';\n\nexport function withDelay(\n  delayMs: number,\n  _nextAnimation: NextAnimation<DelayAnimation>\n): Animation<DelayAnimation> {\n  'worklet';\n  return defineAnimation<DelayAnimation>(_nextAnimation, () => {\n    'worklet';\n    const nextAnimation =\n      typeof _nextAnimation === 'function' ? _nextAnimation() : _nextAnimation;\n\n    function delay(animation: DelayAnimation, now: Timestamp): boolean {\n      const { startTime, started, previousAnimation } = animation;\n\n      if (now - startTime > delayMs) {\n        if (!started) {\n          nextAnimation.onStart(\n            nextAnimation,\n            animation.current,\n            now,\n            previousAnimation as DelayAnimation\n          );\n          animation.previousAnimation = null;\n          animation.started = true;\n        }\n        const finished = nextAnimation.onFrame(nextAnimation, now);\n        animation.current = nextAnimation.current;\n        return finished;\n      } else if (previousAnimation) {\n        const finished =\n          previousAnimation.finished ||\n          previousAnimation.onFrame(previousAnimation, now);\n        animation.current = previousAnimation.current;\n        if (finished) {\n          animation.previousAnimation = null;\n        }\n      }\n      return false;\n    }\n\n    function onStart(\n      animation: DelayAnimation,\n      value: AnimatableValue,\n      now: Timestamp,\n      previousAnimation: DelayAnimation\n    ): void {\n      animation.startTime = now;\n      animation.started = false;\n      animation.current = value;\n      if (previousAnimation === animation) {\n        animation.previousAnimation = previousAnimation.previousAnimation;\n      } else {\n        animation.previousAnimation = previousAnimation;\n      }\n    }\n\n    const callback = (finished?: boolean): void => {\n      if (nextAnimation.callback) {\n        nextAnimation.callback(finished);\n      }\n    };\n\n    return {\n      isHigherOrder: true,\n      onFrame: delay,\n      onStart,\n      current: nextAnimation.current,\n      callback,\n      previousAnimation: null,\n      startTime: 0,\n      started: false,\n    };\n  });\n}\n"]},"metadata":{},"sourceType":"module"}