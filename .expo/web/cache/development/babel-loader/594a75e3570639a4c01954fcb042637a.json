{"ast":null,"code":"import { useRef } from 'react';\nimport { useSharedValue } from \"./useSharedValue\";\nimport { getTag } from \"../NativeMethods\";\nimport { getShadowNodeWrapperFromHostInstance } from \"../fabricUtils\";\nimport { makeShareableCloneRecursive, registerShareableMapping } from \"../shareables\";\nfunction getShareableShadowNodeFromComponent(component) {\n  return getShadowNodeWrapperFromHostInstance(component);\n}\nvar getTagValueFunction = global._IS_FABRIC ? getShareableShadowNodeFromComponent : getTag;\nexport function useAnimatedRef() {\n  var tag = useSharedValue(-1);\n  var ref = useRef();\n  if (!ref.current) {\n    var fun = function fun(component) {\n      if (component) {\n        tag.value = getTagValueFunction(component);\n        fun.current = component;\n      }\n      return tag.value;\n    };\n    fun.current = null;\n    var remoteRef = makeShareableCloneRecursive({\n      __init: function __init() {\n        'worklet';\n\n        return function () {\n          return tag.value;\n        };\n      }\n    });\n    registerShareableMapping(fun, remoteRef);\n    ref.current = fun;\n  }\n  return ref.current;\n}","map":{"version":3,"mappings":"AAAA,SAAoBA,MAApB,QAAkC,OAAlC;AACA,SAASC,cAAT;AAGA,SAASC,MAAT;AACA,SAASC,oCAAT;AACA,SACEC,2BADF,EAEEC,wBAFF;AAKA,SAASC,mCAAT,CACEC,SADF,EAEqB;EACnB,OAAOJ,oCAAoC,CAACI,SAAD,CAA3C;AACD;AAED,IAAMC,mBAAmB,GAAGC,MAAM,CAACC,UAAP,GACxBJ,mCADwB,GAExBJ,MAFJ;AAIA,OAAO,SAASS,cAAT,GAAqE;EAC1E,IAAMC,GAAG,GAAGX,cAAc,CAAoC,CAAC,CAArC,CAA1B;EACA,IAAMY,GAAG,GAAGb,MAAM,EAAlB;EAEA,IAAI,CAACa,GAAG,CAACC,OAAT,EAAkB;IAChB,IAAMC,GAAyB,GAA2BR,SAApDQ,GAAyB,CAA2BR,SAAD,EAAe;MAEtE,IAAIA,SAAJ,EAAe;QACbK,GAAG,CAACI,KAAJ,GAAYR,mBAAmB,CAACD,SAAD,CAA/B;QACAQ,GAAG,CAACD,OAAJ,GAAcP,SAAd;MACD;MACD,OAAOK,GAAG,CAACI,KAAX;IACD,CAPD;IASAD,GAAG,CAACD,OAAJ,GAAc,IAAd;IAEA,IAAMG,SAAS,GAAGb,2BAA2B,CAAC;MAC5Cc,MAAM,EAAE,kBAAM;QACZ;;QACA,OAAO;UAAA,OAAMN,GAAG,CAACI,KAAjB;QAAA;MACD;IAJ2C,CAAD,CAA7C;IAMAX,wBAAwB,CAACU,GAAD,EAAME,SAAN,CAAxB;IAEAJ,GAAG,CAACC,OAAJ,GAAcC,GAAd;EACD;EAED,OAAOF,GAAG,CAACC,OAAX;AACD","names":["useRef","useSharedValue","getTag","getShadowNodeWrapperFromHostInstance","makeShareableCloneRecursive","registerShareableMapping","getShareableShadowNodeFromComponent","component","getTagValueFunction","global","_IS_FABRIC","useAnimatedRef","tag","ref","current","fun","value","remoteRef","__init"],"sources":["useAnimatedRef.ts"],"sourcesContent":["import { Component, useRef } from 'react';\nimport { useSharedValue } from './useSharedValue';\nimport { RefObjectFunction } from './commonTypes';\nimport { ShadowNodeWrapper } from '../commonTypes';\nimport { getTag } from '../NativeMethods';\nimport { getShadowNodeWrapperFromHostInstance } from '../fabricUtils';\nimport {\n  makeShareableCloneRecursive,\n  registerShareableMapping,\n} from '../shareables';\n\nfunction getShareableShadowNodeFromComponent(\n  component: Component\n): ShadowNodeWrapper {\n  return getShadowNodeWrapperFromHostInstance(component);\n}\n\nconst getTagValueFunction = global._IS_FABRIC\n  ? getShareableShadowNodeFromComponent\n  : getTag;\n\nexport function useAnimatedRef<T extends Component>(): RefObjectFunction<T> {\n  const tag = useSharedValue<number | ShadowNodeWrapper | null>(-1);\n  const ref = useRef<RefObjectFunction<T>>();\n\n  if (!ref.current) {\n    const fun: RefObjectFunction<T> = <RefObjectFunction<T>>((component) => {\n      // enters when ref is set by attaching to a component\n      if (component) {\n        tag.value = getTagValueFunction(component);\n        fun.current = component;\n      }\n      return tag.value;\n    });\n\n    fun.current = null;\n\n    const remoteRef = makeShareableCloneRecursive({\n      __init: () => {\n        'worklet';\n        return () => tag.value;\n      },\n    });\n    registerShareableMapping(fun, remoteRef);\n\n    ref.current = fun;\n  }\n\n  return ref.current;\n}\n"]},"metadata":{},"sourceType":"module"}